name: wheel

on:
    push:
        branches:
            - main
    pull_request:
        branches:
            - main

jobs:
    build_wheel:
        runs-on: ubuntu-20.04
        container:
            image: ghcr.io/daizhirui/gp-sddf-ubuntu20.04:latest
            credentials:
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_TOKEN }}
        steps:
            -   name: Checkout repository and submodules
                uses: actions/checkout@v3
                with:
                    submodules: recursive
            -   name: git safe.directory
                run: git config --global --add safe.directory '*'
            # -   name: Install Python Packages
                # run: pip3 install -r requirements.txt --user
            -   name: Build Wheel
                run: python3 setup.py bdist_wheel
            -   uses: actions/upload-artifact@v2
                with:
                    name: wheel_file
                    path: dist/bc_exploration-0.0.1-cp38-cp38-linux_x86_64.whl
    install_wheel:
        runs-on: ubuntu-20.04
        container:
            image: ghcr.io/daizhirui/gp-sddf-ubuntu20.04:latest
            credentials:
                username: ${{ secrets.DOCKER_USERNAME }}
                password: ${{ secrets.DOCKER_TOKEN }}
        steps:
            -   uses:
                    actions/download-artifact@v2
                with:
                    name: wheel_file
                    path: dist/bc_exploration-0.0.1-cp38-cp38-linux_x86_64.whl
            -   name: Install Wheel
                run: pip3 install dist/bc_exploration-0.0.1-cp38-cp38-linux_x86_64.whl
